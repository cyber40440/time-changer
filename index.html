<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Time Changer</title>
<style>
  body { font-family: Arial, sans-serif; text-align: center; background: #222; color: #fff; }
  button { font-size: 18px; padding: 10px 15px; margin: 8px; cursor: pointer; border: none; border-radius: 5px; background: #4CAF50; color: white; transition: background 0.3s; }
  button:disabled { background: #555; cursor: not-allowed; }
  #shop { margin-top: 30px; border-top: 2px solid #555; padding-top: 15px; }
  .upgrade { margin: 10px 0; }
  h1, h2 { margin-bottom: 10px; }
</style>
</head>
<body>

<h1>Time Changer ⏳</h1>
<p>Time Points: <span id="timePoints">0</span></p>
<p>Points per click: <span id="clickValueDisplay">1</span></p>
<p>Auto Time/sec: <span id="autoTimeDisplay">0</span></p>
<button id="clickTime">Generate Time +1</button>

<div id="shop">
  <h2>Upgrades</h2>
  <div id="upgradeList"></div>
</div>

<script>
let timePoints = 0;
let clickValue = 1;
let autoTime = 0;
let temporalLoop = false;

// Define upgrades. Stackable upgrades have 'baseCost', 'isStackable: true', and 'count'.
const upgrades = [
  // Stackable Auto Time Upgrades (Cost increases after each purchase)
  { id: 'auto1', name: "Auto Time (+1/sec)", baseCost: 50, currentCost: 50, isStackable: true, count: 0, effect: () => autoTime += 1 },
  { id: 'auto10', name: "Time Warp (+10/sec)", baseCost: 500, currentCost: 500, isStackable: true, count: 0, effect: () => autoTime += 10 },
  { id: 'auto20', name: "Hourglass Booster (+20/sec)", baseCost: 1200, currentCost: 1200, isStackable: true, count: 0, effect: () => autoTime += 20 },
  { id: 'auto50', name: "Chrono Clock (+50/sec)", baseCost: 2000, currentCost: 2000, isStackable: true, count: 0, effect: () => autoTime += 50 },
  { id: 'auto100', name: "Time Machine (+100/sec)", baseCost: 3000, currentCost: 3000, isStackable: true, count: 0, effect: () => autoTime += 100 },
  { id: 'auto500', name: "Eternal Clock (+500/sec)", baseCost: 10000, currentCost: 10000, isStackable: true, count: 0, effect: () => autoTime += 500 },

  // One-Time Click/Multiplier Upgrades (Disabled after one purchase)
  { id: 'click5', name: "Temporal Crystal (+5/click)", baseCost: 750, currentCost: 750, isStackable: false, effect: () => clickValue += 5 },
  { id: 'mult2', name: "Time Multiplier (double all gains)", baseCost: 1500, currentCost: 1500, isStackable: false, effect: () => { clickValue *= 2; autoTime *= 2 } },
  { id: 'loop', name: "Temporal Loop (click gain = auto/sec)", baseCost: 1800, currentCost: 1800, isStackable: false, effect: () => { temporalLoop = true } },
  { id: 'mult1.5', name: "Minute Multiplier (+50% auto gains)", baseCost: 1200, currentCost: 1200, isStackable: false, effect: () => { autoTime = Math.floor(autoTime * 1.5) } },

  // One-Time Consumable Upgrades (Disabled after one purchase)
  { id: 'leap', name: "Quantum Leap (+500 Time)", baseCost: 800, currentCost: 800, isStackable: false, effect: () => { timePoints += 500 } },
  { id: 'potion', name: "Time Potion (+50/click for 30s)", baseCost: 900, currentCost: 900, isStackable: false, effect: () => temporaryClickBoost(50, 30000) },
];


// --- Initial Setup ---

const upgradeList = document.getElementById('upgradeList');

// Dynamically generate upgrade buttons
upgrades.forEach((u, index) => {
  const div = document.createElement('div');
  div.className = "upgrade";
  const btn = document.createElement('button');
  btn.id = `buy-${u.id}`; // Unique ID for cost checking
  
  if (u.isStackable) {
    btn.textContent = `${u.name} - Cost: ${u.currentCost} (Level ${u.count})`;
  } else {
    btn.textContent = `${u.name} - Cost: ${u.currentCost}`;
  }
  
  // Use 'mousedown' event for a slightly faster response on mobile/desktop clicks
  btn.addEventListener('click', () => buyUpgrade(index));
  div.appendChild(btn);
  upgradeList.appendChild(div);
});

// Click button handler
document.getElementById('clickTime').addEventListener('click', () => {
  let gain = clickValue;
  if(temporalLoop) gain += autoTime; // Apply Temporal Loop bonus
  timePoints += gain;
  updateDisplay();
  **checkButtonCosts(); // <-- FIX: Ensures buttons enable immediately**
});


// --- Core Game Functions ---

// Function to buy an upgrade
function buyUpgrade(index) {
  const u = upgrades[index];
  const btn = document.getElementById(`buy-${u.id}`);
  
  if(timePoints >= u.currentCost) {
    timePoints -= u.currentCost;
    u.effect(); // Apply the upgrade's effect

    if (u.isStackable) {
      // Increase cost for stackable upgrades (1.5x multiplier)
      u.count++;
      u.currentCost = Math.floor(u.baseCost * Math.pow(1.5, u.count));
      btn.textContent = `${u.name} - Cost: ${u.currentCost} (Level ${u.count})`;
    } else {
      // Disable button for one-time purchases
      btn.disabled = true; 
    }
    
    updateDisplay();
    checkButtonCosts(); // Ensure other buttons update if we gained points (Quantum Leap) or reduced points
  }
}

// Function for the temporary click boost
function temporaryClickBoost(amount, duration) {
  // Prevent activating if another boost is running
  if (document.getElementById('boostStatus')) return; 

  clickValue += amount;
  updateDisplay();

  // Add a visual cue for the boost
  const status = document.createElement('p');
  status.id = 'boostStatus';
  status.textContent = `⚡ Click Boost (+${amount}) active for ${duration/1000}s!`;
  document.getElementById('shop').prepend(status);

  setTimeout(() => {
    clickValue -= amount; // Remove the boost
    status.remove();
    updateDisplay();
  }, duration);
}

// Auto time increment every second (Game loop)
setInterval(() => {
  timePoints += autoTime;
  updateDisplay();
  checkButtonCosts(); // Check costs every second to enable/disable buttons
}, 1000);

// Update all displayed stats
function updateDisplay() {
  document.getElementById('timePoints').textContent = Math.floor(timePoints);
  document.getElementById('clickValueDisplay').textContent = clickValue;
  document.getElementById('autoTimeDisplay').textContent = Math.floor(autoTime);
}

// Check which upgrade buttons the player can afford (The usability fix)
function checkButtonCosts() {
  upgrades.forEach(u => {
    const btn = document.getElementById(`buy-${u.id}`);
    // Only check and enable/disable if the button exists and is not already a one-time purchase disabled
    if (btn && !btn.disabled) {
      btn.disabled = timePoints < u.currentCost;
    }
  });
}

// Initial display setup
updateDisplay();
checkButtonCosts();
</script>

</body>
</html>
